name: è‡ªåŠ¨æ›´æ–° Cloudflare IP åœ°å€æ± 

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */12 * * *'  # æ¯12å°æ—¶æ‰§è¡Œä¸€æ¬¡

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: âœ… æ£€å‡ºä»“åº“
        uses: actions/checkout@v3

      - name: ğŸ§° å®‰è£…ä¾èµ–
        run: sudo apt update && sudo apt install -y curl jq

      - name: ğŸ“¥ æ‰§è¡Œæ”¶é›†è„šæœ¬
        env:
          IPINFO_TOKEN: ${{ secrets.IPINFO_TOKEN }}
        run: bash collect_ips.sh

      - name: ğŸ› ï¸ æäº¤æ›´æ–°
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "actions@github.com"
          git add ip-json/*.json 2>/dev/null || echo "âš ï¸ æ²¡æœ‰åŒ¹é…çš„æ–‡ä»¶"
          git commit -m "âœ… è‡ªåŠ¨æ›´æ–° IP åœ°å€æ±  - $(date '+%Y-%m-%d %H:%M:%S')" || echo "âœ… æ²¡æœ‰éœ€è¦æäº¤çš„æ›´æ”¹"

      - name: ğŸš€ æ¨é€æ›´æ–°
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          git remote set-url origin https://${GH_TOKEN}@github.com/${{ github.repository }}
          git push origin main
